#include "Simulator.hpp"
#include "Logger.hpp"
/*
std::vector<std::vector<uint32_t>> edges={
    {0,1,1},
    {0,2,3},
    {0,3,3},
    {1,2,2},
    {1,4,2},
    {1,5,4},
    {2,3,2},
    {2,5,1},
    {3,6,2},
    {4,5,2},
    {5,6,1}
};
*/
/*
std::vector<std::vector<uint32_t>> edges=
{
    {0,1,1},
    {0,2,3},
    {0,3,3},
    {0,5,4},
    {0,10,1},
    {1,2,2},
    {1,4,2},
    {2,3,3},

    {5,6,1},
    {5,7,3},
    {5,8,3},
    {6,7,2},
    {6,9,2},
    {7,8,3},
    
    {10,11,1},
    {10,12,3},
    {10,13,3},
    {11,12,2},
    {11,14,2},
    {12,13,3}


};
*/
std::vector<std::vector<uint32_t>> edges=
{
    // 子网1: 节点0-4 (网关:0) - 排在最前面
    {0,1,1}, {0,2,3}, {0,3,3}, {0,4,4},
    {0,5,2}, {0,10,3},  // 网关0连接网关5和10
    
    // 继续子网1的内部连接
    {1,2,2}, {1,3,1}, {2,3,2}, {3,4,1},
    
    // 子网2: 节点5-9 (网关:5)
    {5,6,1}, {5,7,3}, {5,8,3}, {5,9,4},
    {5,15,2}, {5,20,3},  // 网关5连接网关15和20
    
    // 继续子网2的内部连接
    {6,7,2}, {6,8,1}, {7,8,2}, {8,9,1},
    
    // 子网3: 节点10-14 (网关:10)
    {10,11,1}, {10,12,3}, {10,13,3}, {10,14,4},
    {10,25,2}, {10,30,3},  // 网关10连接网关25和30
    
    // 继续子网3的内部连接
    {11,12,2}, {11,13,1}, {12,13,2}, {13,14,1},
    
    // 子网4: 节点15-19 (网关:15)
    {15,16,1}, {15,17,3}, {15,18,3}, {15,19,4},
    {15,35,2}, {15,40,3},  // 网关15连接网关35和40
    
    // 继续子网4的内部连接
    {16,17,2}, {16,18,1}, {17,18,2}, {18,19,1},
    
    // 子网5: 节点20-24 (网关:20)
    {20,21,1}, {20,22,3}, {20,23,3}, {20,24,4},
    {20,45,2},  // 网关20连接网关45
    
    // 继续子网5的内部连接
    {21,22,2}, {21,23,1}, {22,23,2}, {23,24,1},
    
    // 子网6: 节点25-29 (网关:25)
    {25,26,1}, {25,27,3}, {25,28,3}, {25,29,4},
    {25,35,1},  // 网关25连接网关35
    
    // 继续子网6的内部连接
    {26,27,2}, {26,28,1}, {27,28,2}, {28,29,1},
    
    // 子网7: 节点30-34 (网关:30)
    {30,31,1}, {30,32,3}, {30,33,3}, {30,34,4},
    {30,40,1},  // 网关30连接网关40
    
    // 继续子网7的内部连接
    {31,32,2}, {31,33,1}, {32,33,2}, {33,34,1},
    
    // 子网8: 节点35-39 (网关:35)
    {35,36,1}, {35,37,3}, {35,38,3}, {35,39,4},
    {35,45,2},  // 网关35连接网关45
    
    // 继续子网8的内部连接
    {36,37,2}, {36,38,1}, {37,38,2}, {38,39,1},
    
    // 子网9: 节点40-44 (网关:40)
    {40,41,1}, {40,42,3}, {40,43,3}, {40,44,4},
    
    // 继续子网9的内部连接
    {41,42,2}, {41,43,1}, {42,43,2}, {43,44,1},
    
    // 子网10: 节点45-49 (网关:45)
    {45,46,1}, {45,47,3}, {45,48,3}, {45,49,4},
    
    // 继续子网10的内部连接
    {46,47,2}, {46,48,1}, {47,48,2}, {48,49,1}
};

std::vector<std::vector<int>> modify_edges={
    {1,5,1,5000},
    {1,5,UNREACHABLE,10000}
};


util::Graph GenerateGraph(const std::vector<std::vector<uint32_t>>& edges)
{
    util::Graph graph;
    for(auto& edge:edges)
    {
        auto s=edge[0],t=edge[1],metric=edge[2];
        if(s>=graph.size())
            graph.resize(s+1);
        graph[s].push_back({t,metric});
        if(t>=graph.size())
            graph.resize(t+1);
        graph[t].push_back({s,metric});
    }
    return graph;
}
int main()
{
    auto logger=Logger::GetInstance();
    logger->SetType(LogType::INFO);
    LOG_INFO("DSDV Simulator Start\n");

    auto graph=GenerateGraph(edges);

    simulator::Simulator sim(graph);
    //sim.SetModifyLinks(modify_edges);
    sim.Start();
    
    return 0;
}